apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - manager.yaml
  - images.yaml

replacements:
  - source:
      kind: ConfigMap
      name: cert-manager-images
      fieldPath: data.cert-manager-webhook
    targets:
      - select:
          kind: Deployment
          name: controller-manager
        fieldPaths:
          - spec.template.spec.containers.[name=cert-manager-operator].env.[name=RELATED_IMAGE_CERT_MANAGER_WEBHOOK].value
  - source:
      kind: ConfigMap
      name: cert-manager-images
      fieldPath: data.cert-manager-ca-injector
    targets:
      - select:
          kind: Deployment
          name: controller-manager
        fieldPaths:
          - spec.template.spec.containers.[name=cert-manager-operator].env.[name=RELATED_IMAGE_CERT_MANAGER_CA_INJECTOR].value
  - source:
      kind: ConfigMap
      name: cert-manager-images
      fieldPath: data.cert-manager-controller
    targets:
      - select:
          kind: Deployment
          name: controller-manager
        fieldPaths:
          - spec.template.spec.containers.[name=cert-manager-operator].env.[name=RELATED_IMAGE_CERT_MANAGER_CONTROLLER].value
  - source:
      kind: ConfigMap
      name: cert-manager-images
      fieldPath: data.cert-manager-acmesolver
    targets:
      - select:
          kind: Deployment
          name: controller-manager
        fieldPaths:
          - spec.template.spec.containers.[name=cert-manager-operator].env.[name=RELATED_IMAGE_CERT_MANAGER_ACMESOLVER].value
  - source:
      kind: ConfigMap
      name: cert-manager-images
      fieldPath: data.cert-manager-istiocsr
    targets:
      - select:
          kind: Deployment
          name: controller-manager
        fieldPaths:
          - spec.template.spec.containers.[name=cert-manager-operator].env.[name=RELATED_IMAGE_CERT_MANAGER_ISTIOCSR].value
  - source:
      kind: ConfigMap
      name: cert-manager-images
      fieldPath: data.controller
    targets:
      - select:
          kind: Deployment
          name: controller-manager
        fieldPaths:
          - spec.template.spec.containers.[name=cert-manager-operator].image
